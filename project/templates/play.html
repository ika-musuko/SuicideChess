{# play.html #}
{# page for playing the game. contains the react app (as compiled javascript) which is the actual game #}

{% extends "base.html" %}
{% set title = "play "+room_id %}
{% block head %}
<head>
    {# REACT: css styling for the react app #}
    <link href="{{ url_for('static', filename='react/static/css/game_compiled.css') }}" rel="stylesheet">
</head>
{% endblock %}

{% block content %}

{# show the room id #}
<h2>GAME!!!! {{ room_id }}</h2>


{% set waiting_for_friend = room["mode"] == "friend" and room["status"] == "waiting" %}

{# show an invite link if the user is waiting for a friend #}
{% if waiting_for_friend %}
<p>this is a FRIEND room... </p>
{% set friend_url = url_for('invite', room_id=room_id, access_code=room['accessCode']) %}
<p>right click <a href="{{ friend_url }}" id="inviteLink">here</a>, click "copy to clipboard" and then send it to a friend so they can play too!</p>
{% endif %}

{# show the player list #}
<h3><b>players: </b></h3>
{% set players = room_manager.get_players_by_id(room_id) %}
{% if players %}
    <ul class="playerList">
        {% for player_id in players %}
            {% set player_data = player_manager.get_user(player_id) %}
            <li><a class="playerLink" href="{{ url_for('user', user_id=player_id) }}">{{ player_data["displayName"] }}</a></li>
        {% endfor %}
    </ul>
{% endif %}


{% if room["status"] == "inprogress" and debug %}
    <a href="{{ url_for('simulate_game', room_id=room_id) }}">simulate game</a>

{# if the game is over show winner, rematch link, and exit link #}
{# debug mode automatic game complete #}

{% elif room["status"] == "finished" %}
    <b>this game is OVER!!!</b>
    <p>winner: {{ player_manager.get_display_name(room["winner"]) }}</p>
    <p>move list: {{ room["moveList"] }}</p>
    {# has the current user clicked rematch yet #}
    {% if room["rematchReady"][current_user.id] %} {# YES THEY HAVE #}
        <h3>waiting for the opponent to rematch...</h3>
    {% else %}
        <a href="{{ url_for('rematch', room_id=room_id) }}">REMATCH</a>
    {% endif %}
        <a href="{{ url_for('exit_game', room_id=room_id) }}">EXIT</a>


{# else room is waiting, show an exit link #}
{% else %}
    <h3>waiting for opponent......</h3>
    <a href="{{ url_for('exit_game', room_id=room_id) }}">EXIT</a>
{% endif %}

{# REACT: container for the game #}
<div id="gameRoot" user="{{ user_id }}" roomID="{{ room_id }}"></div>

{# REACT: load the react game script #}
<script type="text/javascript" src="{{ url_for('static', filename='react/static/js/game_compiled.js') }}"></script>
{% endblock %}
